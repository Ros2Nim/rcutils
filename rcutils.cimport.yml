
imports:

- name: "rcutils"
  sources: "deps/rcutils/include"
  globs: ["**/*.h"]
  skips:
  - "rcutils/stdatomic_helper/win32/stdatomic.h"
  - "rcutils/stdatomic_helper/gcc/stdatomic.h"
  - "rcutils/stdatomic_helper.h"
  includes: [
    "deps/rcutils/include",
    ]
  
  cSourceModifications:
  - cSourceModification: "'rcutils/visibility_control.h'"
    deletes:
    - match: "'RCUTILS_PUBLIC'"
    - match: "'RCUTILS_PUBLIC_TYPE'"
  - cSourceModification: "'rcutils/error_handling.h'"
    deletes:
    - match: "'make sure our math is right'"
      until: "'Maximum length calculations incorrect'"
      inclusive: true
  - cSourceModification: "'rcutils/macros.h'"
    deletes:
    - match: "'RCUTILS_THREAD_LOCAL'"
  - cSourceModification: "'rcutils/error_handling.h'"
    deletes:
    - match: "'__STDC_WANT_LIB_EXT1__'"
  - cSourceModification: "'rcutils/testing/fault_injection.h'"
    c2NimExtras:
    - fileContents: |
        #mangle "'_rcutils_fault_injection_maybe_fail'" "rcutils_fault_injection_maybe_fail"
  - cSourceModification: "'rcutils/logging.h'"
    deletes:
    - match: "'RCUTILS_LOGGING_AUTOINIT'"
    - match: "'g_rcutils_log_severity_names'"
    c2NimExtras:
    - rawNims: |
        import ./time
        proc RCUTILS_LOGGING_AUTOINIT*() {.importc: "RCUTILS_LOGGING_AUTOINIT", header: "rcutils/logging.h".}
  - cSourceModification: "'rcutils/isalnum_no_locale.h'"
    c2NimExtras:
    - rawNims: |
        converter charToNum*(c: char): int = c.int 

  - cSourceModification: "'.h'"
    deletes:
    - match: "'RCUTILS_STEADY_TIME'"
    substitutes:
    - peg: "'va_list' \\s+ '*'"
      repl: "va_list"

#pragma c2nim mangle "'ptr va_list'" "varargs[pointer]"

# - name: "rosidl_typesupport_introspection_c"
#   sources: "deps/rosidl/rosidl_typesupport_introspection_c/include"
#   globs: ["**/*.h"]
#   includes: [
#     "deps/rcutils/include",
#     "deps/rosidl/rosidl_runtime_c/include",
#     "deps/rosidl/rosidl_typesupport_interface/include",
#     "deps/rosidl/rosidl_typesupport_introspection_c/include",
#     ]
  
  # cSourceModifications:
  # - cSourceModification: "'field_types.h'"
    # substitutes:
    # - peg: "'rosidl_typesupport_introspection_c__' {\\w+}"
    #   repl: "$1"
    # deletes:
    # - match: "'__ROS_TYPE_BYTE'"
    # - match: "'__ROS_TYPE_BOOL'"
    # - match: "'__ROS_TYPE_FLOAT64'"
    # - match: "'__ROS_TYPE_FLOAT32'"
    # - match: "'__ROS_TYPE_FLOAT32'"
